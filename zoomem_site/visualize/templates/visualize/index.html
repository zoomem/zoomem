{% load staticfiles %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <script type="text/javascript" src={% static "jquery/jquery-1.11.3.min.js" %}></script>

    <link href={% static "codemirror/codemirror.css" %} rel="stylesheet">
    <script type="text/javascript" src={% static "codemirror/codemirror.js" %}></script>
    <script type="text/javascript" src={% static "codemirror/clike.js" %}></script
    <script type="text/javascript" src={% static "codemirror/placeholder.js" %}></script>

    <script type="text/javascript" src={% static "bootstrap/js/bootstrap.min.js" %}></script>
    <link href={% static "bootstrap/css/bootstrap.min.css" %} rel="stylesheet">

    <script type="text/javascript" src={% static "graph_vis/js/raphael-min.js" %}></script>
    <script type="text/javascript" src={% static "graph_vis/js/dracula_graffle.js" %}></script>
    <script type="text/javascript" src={% static "graph_vis/js/dracula_graph.js" %}></script>
    <script type="text/javascript" src={% static "graph_vis/js/dracula_algorithms.js" %}></script>

    <script type="text/javascript" src={% static "visualize/js/graph_bulider.js" %}></script>

    <link href={% static "visualize/css/visualize.css" %} rel="stylesheet" type="text/css">
    <style type="text/css">
      .CodeMirror { border: 1px solid silver; }
      .CodeMirror {width:49.5%}
      .CodeMirror {float:left}
      .CodeMirror pre.CodeMirror-placeholder { color: #999; }
    </style>
  </head>

  <body>
    <div id="drawArea" class = "graph_  area">
      <canvas id="cvs" width="1280" height="720"></canvas>
   </div>

  <div class="center-block">
    <div class="row" style = "margin:1%;">
      <div class="col-lg-6">
        <div class="input-group">
          <span class="input-group-btn">
            <button class="btn btn-default" type="button" id = "prev">Prev</button>
          </span>
          <input type="text" class="form-control" id = "step" placeholder="Number of steps goes here default is 1">
          <span class="input-group-btn">
            <button class="btn btn-default" type="button" id = "next">Next</button>
          </span>
        </div><!-- /input-group -->
      </div><!-- /.col-lg-6 -->
    </div><!-- /.row -->
  </div>

  <div  class = ".highlighted_code">
    <textarea id="cpp-code">{{code}}</textarea>
    <textarea readonly class ="output" placeholder="code output goes here">{{output}}</textarea>
  </div>
  <script>
    $("#next").on("click", function() {
      var number = $('#step');
      var data = 'step=' + number.val();
      $.ajax({
        url: "/visualize/next",
        data:data,
        context: document.body,
         success: function(data) {
          updatePage(data);
         }
       })
    });

    $("#prev").on("click", function() {
      var number = $('#step');
      var data = 'step=' + number.val();

      $.ajax({
        url: "/visualize/prev",
        data:data,
        context: document.body,
         success: function(data) {
           updatePage(data);
         }
       })
    });

    var cppEditor = CodeMirror.fromTextArea(document.getElementById("cpp-code"), {
      lineNumbers: true,
      matchBrackets: true,
      mode: "text/x-c++src",
      readOnly: true
    });

    function updatePage(json){
      highlightLine(json.line_num)
      $(".output").html(json.output)
      drawGraph(json.edges,json.cnt);
    }

    function highlightLine(lineNumber) {
        var WRAP_CLASS = "CodeMirror-activeline";
        var BACK_CLASS = "CodeMirror-activeline-background";
           //Line number is zero based index
       var actualLineNumber = lineNumber - 1;
       var myEditor = $(".CodeMirror");
       console.log(myEditor);
       console.log(myEditor[0].CodeMirror);
       var codeMirrorEditor = myEditor[0].CodeMirror;
       codeMirrorEditor.addLineClass(actualLineNumber, "wrap", WRAP_CLASS);
       codeMirrorEditor.addLineClass(actualLineNumber, "background", BACK_CLASS);
     }
  </script>
  </body>
</html>
